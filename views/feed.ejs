<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Feed</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-zinc-900 text-white min-h-screen">
  <%- include('partials/header', { user: user }) %>

  <div class="max-w-4xl mx-auto p-6">
    <div class="mb-6 bg-zinc-800 p-4 rounded">
      <form action="/post" method="post" class="flex gap-3">
        <input name="content" required placeholder="What's happening?" class="flex-1 px-3 py-2 rounded bg-zinc-700" />
        <button class="bg-blue-600 px-4 rounded">Post</button>
      </form>
    </div>

    <% if (!posts || posts.length === 0) { %>
      <div class="text-zinc-400 text-center">No posts yet.</div>
    <% } else { %>
      <div class="flex flex-col gap-4">
        <% posts.forEach(function(post) { %>
          <div class="bg-zinc-800 p-4 rounded">
            <div class="flex items-center gap-3 mb-2">
              <img src="<%= post.author.profile || '/profile/defaultProfile.png' %>" class="w-10 h-10 rounded-full object-cover" />
              <div>
                <div class="font-semibold"><%= post.author.name %></div>
                <div class="text-xs text-zinc-400"><%= new Date(post.createdAt).toLocaleString() %></div>
              </div>
            </div>

            <div class="mb-3 break-words"><%= post.content %></div>

            <div class="flex items-center gap-2">
              <form action="/posts/<%= post._id %>/like" method="post" class="inline">
                <% const liked = (post.likes || []).map(l => String(l)).includes(String(user._id)); %>
                <button class="<%= liked ? 'bg-red-600' : 'bg-blue-600' %> px-3 py-1 rounded text-xs">
                  ❤️ <%= (post.likes || []).length %>
                </button>
              </form>

              <a href="/user/<%= post.author._id %>" class="text-xs text-zinc-300 ml-2">View Profile</a>

              <% if (String(post.author._id) === String(user._id)) { %>
                <a href="/posts/<%= post._id %>/edit" class="ml-auto text-xs bg-yellow-600 px-2 py-1 rounded">Edit</a>
                <form action="/posts/<%= post._id %>/delete" method="post" class="inline">
                  <button class="ml-2 text-xs bg-red-600 px-2 py-1 rounded">Delete</button>
                </form>
              <% } %>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>
</body>
</html>
