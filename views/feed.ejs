<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Social Feed â€“ Share and Discover Posts</title>
  <!-- Favicon same as index.js -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Ccircle cx='16' cy='16' r='14' fill='%233b82f6'/%3E%3Cellipse cx='16' cy='19' rx='9' ry='6' fill='%23fff'/%3E%3Cellipse cx='16' cy='15.5' rx='7.5' ry='5' fill='%23fff' opacity='0.75'/%3E%3Ccircle cx='11.5' cy='18' r='1.3' fill='%233b82f6'/%3E%3Ccircle cx='16' cy='18' r='1.3' fill='%233b82f6'/%3E%3Ccircle cx='20.5' cy='18' r='1.3' fill='%233b82f6'/%3E%3C/svg%3E">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    body, .bg-main {
      background: #18181b !important;
    }
    .bg-blur-overlay,
    .bg-blur-img {
      display: none !important;
    }
    .card-glass {
      background: rgba(39, 39, 42, 0.26);
      border: 1.5px solid rgba(244,244,245,0.11);
      box-shadow: 0 4px 32px 0 rgba(24,24,27,0.13);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      color: #fff;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .card-glass:hover {
      background: rgba(39, 39, 44, 0.39);
      border-color: rgba(244,244,245,0.18);
      box-shadow: 0 8px 36px 0 rgba(39,39,42,0.17);
    }
    .card-glass textarea,
    .card-glass input {
      background: transparent;
      color: #fff;
    }
    .card-glass textarea::placeholder,
    .card-glass input::placeholder {
      color: #a1a1aa;
    }
    /* ==== CUSTOM INTERACTIVE STYLES ==== */

    button, .icon-btn, [type="submit"], a, .icon-click {
      cursor: pointer !important;
    }
    button,
    .icon-btn,
    input[type="submit"] {
      transition: 
        transform 0.18s,
        background 0.18s,
        color 0.18s,
        border-color 0.18s,
        box-shadow 0.16s;
    }
    button:hover, button:focus,
    input[type="submit"]:hover, input[type="submit"]:focus,
    .icon-btn:hover, .icon-btn:focus {
      transform: scale(1.08);
      filter: brightness(1.08);
      background-color: #2563eb !important;
      box-shadow: 0 4px 18px 0 rgba(96,165,250,0.08);
      outline: none;
    }
    a {
      cursor: pointer;
      border-bottom: 2px solid transparent;
      text-decoration: none;
      transition: 
        border-color 0.17s,
        color 0.18s,
        text-decoration-color 0.17s,
        box-shadow 0.16s;
    }
    a:hover, a:focus-visible {
      color: #60a5fa !important;
      border-bottom: 2px solid #60a5fa;
      text-decoration: underline;
      text-decoration-thickness: 2px;
      text-underline-offset: 3px;
      outline: none;
      box-shadow: 0 2px 12px 0 rgba(39,39,42,0.17);
    }
    .icon-click:hover svg, .icon-click:focus svg,
    button:hover svg, button:focus svg,
    a:hover svg, a:focus svg {
      filter: brightness(1.20) drop-shadow(0 1px 3px #3b82f630);
      transform: scale(1.15);
    }
    .icon-click, .icon-click * {
      cursor: pointer;
    }
    .no-hover,
    .no-hover:focus,
    .no-hover:hover,
    .no-hover svg,
    .no-hover:hover svg,
    .no-hover:focus svg {
      transition: none !important;
      transform: none !important;
      filter: none !important;
      background: none !important;
      box-shadow: none !important;
    }

    /* --- Responsive Tweaks for Small/Medium --- */
    @media (max-width: 640px) {
      .responsive-navbar {
        padding: 0.5rem 0.7rem !important;
      }
      .responsive-form {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.75rem !important;
      }
      .responsive-form textarea {
        min-height: 80px !important;
        font-size: 1rem !important;
      }
      .responsive-form button {
        width: 100% !important;
        justify-content: center;
      }
      .feed-grid-responsive {
        display: flex !important;
        flex-direction: column !important;
        gap: 1rem !important;
      }
    }
    @media (max-width: 768px) and (min-width: 641px) {
      .feed-grid-responsive {
        grid-template-columns: 1fr !important;
      }
      .responsive-form {
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 0.9rem !important;
      }
      .responsive-form textarea {
        min-height: 90px !important;
        font-size: 1.04rem !important;
      }
      .responsive-form button {
        width: 100% !important;
        justify-content: center;
      }
    }
  </style>
</head>

<body class="relative min-h-screen bg-main text-white">
  <div class="relative z-10">
    <%- include('partials/header', { user: user, navClass: 'responsive-navbar' }) %>

    <div class="max-w-7xl mx-auto p-2 sm:p-4 md:p-6">
      <form action="/post" method="post" class="responsive-form flex flex-row gap-2 w-full mb-8 justify-center items-center">
        <textarea
          name="content"
          required
          placeholder="Share something with the world..."
          class="card-glass flex-1 px-3 py-3 border border-zinc-700 bg-transparent rounded-lg text-base placeholder-zinc-400 focus:border-blue-400 outline-none focus:ring-2 focus:ring-blue-300"
          style="min-width: 0; box-shadow:none; resize:vertical;"
        ></textarea>
        <button
          type="submit"
          class="flex items-center gap-2 px-2 py-2 rounded border border-blue-600 bg-blue-700 text-white font-semibold transition hover:bg-blue-800 focus:outline-none"
          style="box-shadow:none;"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
          </svg>
          Post
        </button>
      </form>

      <% if (!posts || posts.length === 0) { %>
        <div class="text-zinc-400 text-center">No posts yet.</div>
      <% } else { %>
        <div class="feed-grid-responsive grid grid-cols-1 sm:grid-cols-1 md:grid-cols-1 xl:grid-cols-4 gap-4 md:gap-6">
          <% posts.forEach(function(post) { %>
            <div class="
              card-glass
              rounded-2xl transition
              flex flex-col
              p-3
            " style="min-width:0;">
              <div class="flex items-center gap-4 mb-3">
                <img 
                  src="<%= post.author.profile || '/profile/defaultProfile.png' %>"
                  class="w-14 h-14 sm:w-16 sm:h-16 rounded-full object-cover border-2 border-zinc-700"
                  style="background:rgba(60,60,65,0.19); box-shadow:none;"
                />
                <div>
                  <div class="font-semibold text-lg sm:text-xl text-white">
                    <a href="/user/<%= post.author._id %>"
                       class="hover:text-blue-400 hover:underline transition focus:outline-none"
                    >
                      <%= post.author.name %>
                    </a>
                  </div>
                  <div class="text-xs sm:text-sm text-zinc-400/80">
                    <%= new Date(post.createdAt).toLocaleString() %>
                  </div>
                </div>
              </div>

              <div class="mb-4 text-white/90 leading-relaxed break-words">
                <%= post.content %>
              </div>

              <div class="flex items-center gap-2 mt-auto">
                <form action="/posts/<%= post._id %>/like" method="post" class="inline">
                  <% const liked = (post.likes || []).map(l => String(l)).includes(String(user._id)); %>
                  <button class="icon-btn p-1 cursor-pointer no-hover flex items-center gap-1 focus:outline-none" style="box-shadow:none;">
                    <svg xmlns="http://www.w3.org/2000/svg" 
                      class="w-6 h-6 <%= liked ? 'text-pink-400' : 'text-blue-400' %>"
                      fill="<%= liked ? 'currentColor' : 'none' %>"
                      viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 21s-6.716-4.867-9.447-9.086C.976 9.818 1.508 6.39 4.21 4.821A5.38 5.38 0 0 1 12 6.04a5.38 5.38 0 0 1 7.79-1.219c2.701 1.569 3.234 4.997 1.657 7.093C18.716 16.133 12 21 12 21Z"/>
                    </svg>
                    <span class="text-xs ml-1 text-white" style="text-shadow:none;"><%= post.likes ? post.likes.length : 0 %></span>
                  </button>
                </form>

                <% if (String(post.author._id) === String(user._id)) { %>
                  <a href="/posts/<%= post._id %>/edit"
                    class="icon-click no-hover ml-auto sm:ml-2 p-1"
                    tabindex="0"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" 
                      fill="none" viewBox="0 0 24 24" stroke="currentColor"
                      class="w-5 h-5 text-yellow-400">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16.862 4.487l1.651-1.652a2.1 2.1 0 113 3L11.25 16.1l-4 1 1-4L16.862 4.487z"/>
                    </svg>
                  </a>
                  <form action="/posts/<%= post._id %>/delete" method="post" class="inline">
                    <button class="icon-btn p-1 no-hover" style="box-shadow:none;">
                      <svg xmlns="http://www.w3.org/2000/svg" 
                        fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5 text-pink-400">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M6 7h12m-1 0l-.867 12.142A2 2 0 0114.138 21H9.862a2 2 0 01-1.995-1.858L7 7m5-4h-1a2 2 0 00-2 2v2h6V5a2 2 0 00-2-2z"/>
                      </svg>
                    </button>
                  </form>
                <% } %>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>
  </div>
  <script>
    // Tailwind handles grid gap/col, nothing needed here.
  </script>
</body>
</html>
